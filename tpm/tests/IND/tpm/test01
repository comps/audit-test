###############################################################################
# (c) Copyright Hewlett-Packard Development Company, L.P., 2006
#
#   This program is free software: you can redistribute it and/or modify
#   it under the terms of version 2 the GNU General Public License as
#   published by the Free Software Foundation.
#
#   This program is distributed in the hope that it will be useful,
#   but WITHOUT ANY WARRANTY; without even the implied warranty of
#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#   GNU General Public License for more details.
#
#   You should have received a copy of the GNU General Public License
#   along with this program.  If not, see <http://www.gnu.org/licenses/>.
###############################################################################

Test1 ()
{
	[ "$IDFLAG" ] && {
		echo "Test1 - Tspi_TPM_SelfTestFull01"
		return 0
	}

	#
	# Force the TPM perform a self-test.  The TPM must be activated,
	# but does not need to be enabled for this test to succeed.
	#
	echo -n "T1: Performing TPM self test..."
	$TESTPATH/tpm/Tspi_TPM_SelfTestFull01 $VERSION 2>>eout >>sout
	case "$?" in
	0 )
		echo "successful."
		return 0
		;;
	17)
		#
		# Code 17 from this test means that the TPM is turned off
		# in BIOS.
		#
		echo "not activated."
		echo "-> The TPM appears to be turned off in BIOS."
		return 17
		;;
	* )
		#
		# Some other error.  Print out the error number and point
		# the user to the error file so they can get more details.
		#
		echo "Failed($ESTAT)."
		echo "-> Check `pwd`/eout for details"
		;;
	esac

	return 1
}
