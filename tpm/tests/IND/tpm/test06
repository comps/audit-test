###############################################################################
# (c) Copyright Hewlett-Packard Development Company, L.P., 2006
#
#   This program is free software: you can redistribute it and/or modify
#   it under the terms of version 2 the GNU General Public License as
#   published by the Free Software Foundation.
#
#   This program is distributed in the hope that it will be useful,
#   but WITHOUT ANY WARRANTY; without even the implied warranty of
#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#   GNU General Public License for more details.
#
#   You should have received a copy of the GNU General Public License
#   along with this program.  If not, see <http://www.gnu.org/licenses/>.
###############################################################################

Test6 ()
{
	[ "$IDFLAG" ] && {
		echo "Test6 - Tspi_TPM_GetCapability"
		return 0
	}

	#
	# Caller can define specific tests in TESTSET.  If TESTSET is null, 
	# assume they want all tests run.
	#
	if [ "$1" ]
	then
		TESTSET="$*"
	else
		TESTSET="01 02 03 04 05 06 07 08 09 10 11 12 13 14 15"
		TESTSET="$TESTSET 16 17 18 19 20 21 22 23 25 26 27 29"

		echo
		echo "T6: Display TPM capabilities..."
	fi

	for K in $TESTSET
	do
		$TESTPATH/tpm/Tspi_TPM_GetCapability$K $VERSION 2>x1 >>sout
		case "$?" in
		0 )
			#
			# The following tests are special cases that either
			# test for failure, and/or have no output.
			#    02 tests for TSS_E_BAD_PARAMETER
			#    03 tests for TSS_E_INVALID_HANDLE
			#    04 queries for an algorithm but has no output
			#
			case "$K" in
			02 )
				echo "	The TPM successfully handles bad parameters."
				;;
			03 )
				echo "	The TPM successfully handles invalid pointers."
				;;
			04 )
				echo "	The TPM was successfully queried for an algorithm."
				;;
			* )
				cat x1
				rm x1
				;;
			esac
			;;
		17 )
			#
			# Code 17 from this test means that the TPM is
			# turned off in BIOS.
			#
			echo "The TPM appears to be turned off in BIOS."
			return 17
			;;
		* )
			TF="$TF $K"
			echo "Tspi_TPM_GetCapability$K unknown error."
			;;
		esac
	done

	[ "$TF" ] && {
		echo "	---------------------------------"
		echo "	The following tests failed: $TF"
	}
}
